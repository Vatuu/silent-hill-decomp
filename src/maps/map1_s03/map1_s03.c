#include "bodyprog/bodyprog.h"
#include "bodyprog/math/math.h"
#include "bodyprog/player_logic.h"
#include "maps/map1/map1_s03.h"
#include "main/rng.h"
#include "maps/shared.h"

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", D_800C9578);

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", g_MapOverlayHeader);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800CBA4C_1_s02); // 0x800CBCE0

#include "maps/shared/sharedFunc_800CBC98_1_s02.h" // 0x800CBF2C

#include "maps/shared/sharedFunc_800CBD58_1_s02.h" // 0x800CBFEC

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800CC03C);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800CD0F4);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800CDCE0);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800CE0CC);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800CE164);

#include "maps/shared/sharedFunc_800CE5D4_1_s03.h" // 0x800CE5D4

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800CE688);

#include "maps/shared/sharedFunc_800CB6B0_0_s00.h" // 0x800CED50

#include "maps/shared/sharedFunc_800CBBBC_0_s00.h" // 0x800CF144

#include "maps/shared/sharedFunc_800CBC94_0_s00.h" // 0x800CF21C

#include "maps/shared/Particle_Update.h" // 0x800CF538

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800CEFF4_0_s00); // 0x800CFB60

#include "maps/shared/sharedFunc_800CF2A4_0_s01.h" // 0x800D0250

#include "maps/shared/sharedFunc_800CEFD0_1_s02.h" // 0x800D02EC

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800CFFF8_0_s00); // 0x800D05D0

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D0690_1_s03); // 0x800D0690

#include "maps/shared/sharedFunc_800CE954_7_s03.h" // 0x800D07DC

#include "maps/shared/sharedFunc_800D01BC_0_s00.h" // 0x800D07E4

#include "maps/shared/sharedFunc_800CF9A8_0_s01.h" // 0x800D089C

#include "maps/shared/sharedFunc_800D08B8_0_s00.h" // 0x800D095C

#include "maps/shared/sharedFunc_800D0A60_0_s00.h" // 0x800D0B04

#include "maps/shared/sharedFunc_800D0B18_0_s00.h" // 0x800D0BBC

#include "maps/shared/sharedFunc_800D0CB8_0_s00.h" // 0x800D0D5C

#include "maps/shared/sharedFunc_800D0E04_0_s00.h" // 0x800D0EA8

#include "maps/shared/sharedFunc_800CFFD8_0_s01.h" // 0x800D0EC8

#include "maps/shared/sharedFunc_800D0850_0_s01.h" // 0x800D1740

#include "maps/shared/sharedFunc_800CDAA8_0_s02.h" // 0x800D1B2C

#include "maps/shared/sharedFunc_800D1C38_0_s00.h" // 0x800D235C

#include "maps/shared/sharedFunc_800D209C_0_s00.h" // 0x800D27AC

#include "maps/shared/sharedFunc_800D20D8_0_s00.h" // 0x800D27E8

#include "maps/shared/sharedFunc_800D20E4_0_s00.h" // 0x800D27F4

#include "maps/shared/sharedFunc_800D2244_0_s00.h" // 0x800D2954

s32 func_800D2B2C() // 0x800D2B2C
{
    return 0;
}

#include "maps/shared/sharedFunc_800D2C7C_0_s00.h" // 0x800D2B34

#include "maps/shared/sharedFunc_800D2D2C_0_s00.h" // 0x800D2BE4

#include "maps/shared/sharedFunc_800D2D44_0_s00.h" // 0x800D2BFC

#include "maps/shared/sharedFunc_800D2D6C_0_s00.h" // 0x800D2C24

#include "maps/shared/sharedFunc_800D2D84_0_s00.h" // 0x800D2C3C

#include "maps/shared/sharedFunc_800D2DAC_0_s00.h" // 0x800D2C64

#include "maps/shared/sharedFunc_800D2E50_0_s00.h" // 0x800D2D08

#include "maps/shared/sharedFunc_800D2E60_0_s00.h" // 0x800D2D18

void func_800D2D24(void) {}

void func_800D2D2C(void) {}

void func_800D2D34(void) {}

void func_800D2D3C(void) {}

void func_800D2D44(void) {}

s32 func_800D2D4C() // 0x800D2D4C
{
    return 0;
}

void func_800D2D54(void) {}

#include "maps/shared/sharedFunc_800D2EA4_0_s00.h" // 0x800D2D5C

#include "maps/shared/sharedFunc_800D2EB4_0_s00.h" // 0x800D2D6C

#include "maps/shared/sharedFunc_800D2EF4_0_s00.h" // 0x800D2DAC

#include "maps/shared/Ai_Stalker_Update.h" // 0x800D2DC0

#include "maps/shared/Ai_Stalker_Init.h" // 0x800D2F54

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D3308_0_s00); // 0x800D31C0

#include "maps/shared/sharedFunc_800D3B44_0_s00.h" // 0x800D39FC

void sharedFunc_800D3EF4_0_s00(s_SubCharacter* chara) {} // 0x800D3DAC

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D4924_0_s00); // 0x800D3DB4

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D492C_0_s00); // 0x800D4984

#include "maps/shared/sharedFunc_800D5098_0_s00.h" // 0x800D50F0

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D54A8_0_s00); // 0x800D5500

#include "maps/shared/sharedFunc_800D5B48_0_s00.h" // 0x800D5BA0

#include "maps/shared/sharedFunc_800D5C64_0_s00.h" // 0x800D5CBC

#include "maps/shared/sharedFunc_800D5FCC_0_s00.h" // 0x800D6024

#include "maps/shared/sharedFunc_800D63D0_0_s00.h" // 0x800D6428

#include "maps/shared/sharedFunc_800D654C_0_s00.h" // 0x800D65A4

#include "maps/shared/sharedFunc_800D6554_0_s00.h" // 0x800D65AC

#include "maps/shared/sharedFunc_800D670C_0_s00.h" // 0x800D6764

#include "maps/shared/sharedFunc_800D67FC_0_s00.h" // 0x800D6854

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D6970_0_s00); // 0x800D69C8

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D70C4_0_s00); // 0x800D711C

#include "maps/shared/sharedFunc_800D7BE8_0_s00.h" // 0x800D7C40

#include "maps/shared/sharedFunc_800D7E04_0_s00.h" // 0x800D7E5C

#include "maps/shared/Ai_Creaper_Update.h" // 0x800D8010

#include "maps/shared/Ai_Creaper_Init.h" // 0x800D80A0

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D7EE8_1_s02); // 0x800D8360

#include "maps/shared/sharedFunc_800D8244_1_s02.h" // 0x800D86BC

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D82F0_1_s02); // 0x800D8768

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D8684_1_s02); // 0x800D8AFC

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D8F30_1_s02); // 0x800D93A8

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D9528_1_s02); // 0x800D99A0

#include "maps/shared/sharedFunc_800D9774_1_s02.h" // 0x800D9BEC

#include "maps/shared/sharedFunc_800D983C_1_s02.h" // 0x800D9CB4

#include "maps/shared/sharedFunc_800D9960_1_s02.h" // 0x800D9DD8

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", sharedFunc_800D99D0_1_s02); // 0x800D9E48

void Ai_LockerDeadBody_Update(s_SubCharacter* chara, s_AnmHeader* anmHdr, GsCOORDINATE2* coords) // 0x800DA284
{
    s_AnimInfo* animInfo;

    if (chara->model_0.state_2 == 0)
    {
        chara->model_0.anim_4.alpha_A = Q12(0.0f);
        Character_AnimSet(chara, ANIM_STATUS(LockerDeadBodyAnim_2, true), 0);
        chara->model_0.state_2++;
        chara->position_18.vy = Q12(0.0f);
    }

    if (!Savegame_EventFlagGet(EventFlag_105))
    {
        chara->model_0.anim_4.flags_2 &= ~AnimFlag_Visible;
        chara->field_E1_0              = 0;
        return;
    }

    chara->model_0.anim_4.flags_2 |= AnimFlag_Visible;

    if (!Savegame_EventFlagGet(EventFlag_106))
    {
        if (chara->model_0.anim_4.status_0 == ANIM_STATUS(LockerDeadBodyAnim_2, true))
        {
            chara->model_0.anim_4.status_0 = ANIM_STATUS(LockerDeadBodyAnim_1, true);
        }

        chara->field_E1_0 = 0;
    }
    else
    {
        Character_AnimSet(chara, ANIM_STATUS(LockerDeadBodyAnim_3, true), 16);
        chara->field_E1_0 = 3;
    }

    Math_MatrixTransform(&chara->position_18, &chara->rotation_24, coords);

    animInfo = &LOCKER_DEAD_BODY_ANIM_INFOS[chara->model_0.anim_4.status_0];
    animInfo->updateFunc_0(&chara->model_0, anmHdr, coords, animInfo);

    chara->field_C8           = Q12(-0.3f);
    chara->field_D8.offsetX_4 = Q12(0.06f);
    chara->field_D8.offsetZ_6 = Q12(0.93f);
    chara->field_CA           = Q12(0.0f);
    chara->field_CC           = Q12(0.0f);
    chara->field_CE           = Q12(0.0f);
    chara->field_D8.offsetX_0 = Q12(0.0f);
    chara->field_D8.offsetZ_2 = Q12(0.0f);
    chara->field_D6           = Q12(0.0f);
    chara->field_D4           = Q12(0.33f);

    func_8005C814(&chara->field_D8, chara);
}

#include "maps/shared/sharedFunc_800D929C_0_s00.h" // 0x800DA424

#include "maps/shared/Map_RoomIdxGet.h" // 0x800DA434

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DA4D4);

void func_800DA630(void) {}

#include "maps/shared/MapEvent_DoorJammed.h" // 0x800DA638

#include "maps/shared/MapEvent_DoorLocked.h" // 0x800DA6CC

#include "maps/shared/MapEvent_DoorUnlocked.h" // 0x800DA760

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DA7F4);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DA8B0);

const char* MAP_MESSAGES[] = {
    #include "maps/shared/mapMsg_common.h"
    "\tWhat's_this? ~E ",
    "\t[The_Monster_Lurks] ~N\n\tis_the_book's_title. ~E ",
    "~C3\tChapter_3: ~N\n\t\t__[Manifestation_of_Delusions] ",
    "~C3\t...Poltergeists_are_among_these. ~N\n\t\tNegative_emotions,_like_fear, ",
    "~C3\tworry_or_stress_manifest ~N\n\t\tinto_external_energy_with ~N\n\t\tphysical_effects. ",
    "~C3\tNightmares_have,_in_some_cases, ~N\n\t\tbeen_shown_to_trigger_them. ",
    "~C3\tHowever,_such_phenomena_do_not ~N\n\t\tappear_to_happen_to_just_anyone. ",
    "~C3\tAlthough_it's_not_clear_why, ~N\n\t\tadolescents,_especially_girls, ~N\n\t\tare_prone_to_such_occurrences. ~E ",
    "~C3\tHearing_this,_the_hunter ~N\n\t\tarmed_with_bow_and_arrow_said, ~N\n\t\t[I_will_kill_the_lizard.] ",
    "~C3\tBut_upon_meeting_his_opponent, ~N\n\t\the_held_back,_taunting, ~N\n\t\t[Who's_afraid_of_a_reptile?] ",
    "~C3\tAt_this,_the_furious_lizard ~N\n\t\thissed,_[I'll_swallow_you_up ~N\n\t\tin_a_single_bite!] ",
    "~C3\tThen_the_huge_creature ~N\n\t\tattacked,_jaws_opened_wide. ",
    "~C3\tThis_was_what_the_man_wanted. ~N\n\t\tCalmly_drawing_his_bow,_he_shot ~N\n\t\tinto_the_lizard's_gaping_mouth. ",
    "~C3\tEffortlessly,_the_arrow_flew, ~N\n\t\tpiercing_the_defenseless_maw, ",
    "~C3\tand_the_lizard_fell_down_dead. ~E ",
    "\tThis_is_from_an_old_fairy_tale. ~N\n\tI_remember_reading_it_as_a_kid. ~E ",
    "\tThere's_a_drainage_valve. ~N\n\tNothing_unusual. ~E ",
    "\tThere's_a_hanging_key. ~N\n\tIt's_just_out_of_reach. ~E ",
    "\tThe_key_went_down_the_drain. ~E ",
    "\tThe_ball_is_stuffed ~N\n\tinside_the_pipe. ~E ",
    "\tNothing_special. ~E ",
    "\tUsed_the_ ~C2 Rubber_ball ~C7 . ~E ",
    "\tUsed_the_ ~C2 Library_reserve_key ~C7 . ~E ",
    "\tUsed_the_ ~C2 Classroom_key ~C7 . ~E ",
    "\tNo_useful_books. ~E ",
    "\tThere_is_a_drainage_valve. ~N\n\tDo_you_want_to_open_it? ~S4 ",
    "\tIt_drains_into_the_wrong_hole. ~N\n\tMaybe_I_could_plug ~N\n\tthat_up_somehow. ~E ",
    "\tNothing_useful_in_the_locker. ~E ",
    "\tNothing_inside. ~E ",
    "\tThere_is_a_ ~C2 Library_reserve_key ~C7 . ~N\n\tTake_it? ~S4 ",
    "\tA_body_is_slumped_over. ~E ",
    "~J0(1.0)\tWhat? ~E ",
    "~J0(2.5)\tThat_light!? ~E "
};

void func_800DA950(void) // 0x800DA950
{
    u32 pickupType;
    s32 eventFlagIdx;

    pickupType   = CommonPickupItemId_FirstAidKit;
    eventFlagIdx = 0;

    switch (g_MapEventParam->field_5)
    {
        case 84:
            pickupType   = CommonPickupItemId_ShotgunShells;
            eventFlagIdx = EventFlag_M1S03_ShotgunShells0;
            break;

        case 85:
            pickupType   = CommonPickupItemId_HandgunBullets;
            eventFlagIdx = EventFlag_M1S03_HandgunBullets0;
            break;

        case 86:
            pickupType   = CommonPickupItemId_HealthDrink;
            eventFlagIdx = EventFlag_M1S03_HealthDrink0;
            break;

        case 87:
            pickupType   = CommonPickupItemId_HandgunBullets;
            eventFlagIdx = EventFlag_M1S03_HandgunBullets1;
            break;

        case 88:
            pickupType   = CommonPickupItemId_HandgunBullets;
            eventFlagIdx = EventFlag_M1S03_HandgunBullets2;
            break;

        case 89:
            pickupType   = CommonPickupItemId_ShotgunShells;
            eventFlagIdx = EventFlag_M1S03_ShotgunShells1;
            break;

        case 90:
            pickupType   = CommonPickupItemId_HandgunBullets;
            eventFlagIdx = EventFlag_M1S03_HandgunBullets3;
            break;

        case 91:
            pickupType   = CommonPickupItemId_HealthDrink;
            eventFlagIdx = EventFlag_M1S03_HealthDrink1;
            break;

        case 92:
            pickupType   = CommonPickupItemId_HealthDrink;
            eventFlagIdx = EventFlag_M1S03_HealthDrink2;
            break;

        case 93:
            pickupType   = CommonPickupItemId_FirstAidKit;
            eventFlagIdx = EventFlag_M1S03_FirstAidKit;
            break;
    }

    Event_CommonItemTake(pickupType, eventFlagIdx);
}

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DAA28);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DABC4);

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", D_800CBAA4);

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", D_800CBAB0);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DAF18);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DBEC8);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DC0F8);

void func_800DC2E4(void) // 0x800DC2E4
{
    MapMsg_DisplayWithTexture(FILE_TIM_LOCKER1_TIM, Q12(2.5f), Q12(2.5f), 43);
}

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DC310);

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", D_800CBB88);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DC780);

void func_800DC9A0(void) // 0x800DC9A0
{
    switch (g_SysWork.sysStateStep_C[0])
    {
        case 0:
            sharedFunc_800D20E4_0_s00();
            func_80086470(0, InventoryItemId_LibraryReserveKey, 0, false);
            SysWork_StateStepIncrement(0);

        case 1:
            func_80085DF0();
            break;

        case 2:
            func_80086C58(&g_SysWork.player_4C.chara_0, 59);
            break;

        case 3:
            func_80086470(1, InventoryItemId_LibraryReserveKey, 0, false);
            break;

        case 4:
            Savegame_EventFlagSet(EventFlag_M1S03_PickupLibraryReserveKey);
            if (Gfx_PickupItemAnimate(InventoryItemId_LibraryReserveKey))
            {
                MapMsg_DisplayAndHandleSelection(true, 44, 5, 6, 0, false);
            }
            if (g_SysWork.sysStateStep_C[0] == 6)
            {
                Savegame_EventFlagClear(EventFlag_M1S03_PickupLibraryReserveKey);
            }
            break;

        case 5:
            func_80086470(3, InventoryItemId_LibraryReserveKey, 1, false);
            SysWork_StateStepIncrement(0);

        case 6:
            func_80086C58(&g_SysWork.player_4C.chara_0, 60);
            break;

        default:
            sharedFunc_800D2244_0_s00(false);
            SysWork_StateSetNext(SysState_Gameplay);
            break;
    }
}

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", D_800CBBCC);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DCB54);

#include "maps/shared/SysWork_StateStepIncrementAfterTime.h" // 0x800DCD44

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", D_800CBC04);

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", D_800CBC0C);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DCDDC);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DD3AC);

INCLUDE_ASM("asm/maps/map1_s03/nonmatchings/map1_s03", func_800DD688);

void func_800DE624(void)
{
    s32 playerHp;

    if (Savegame_EventFlagGet(EventFlag_M1S02_PickupClassroomKey) && g_SavegamePtr->gameDifficulty_260 != GameDifficulty_Easy)
    {
        func_80088FF4(Chara_GreyChild, 9, 3);
        func_80088FF4(Chara_GreyChild, 10, 3);
    }

    if (Savegame_EventFlagGet(EventFlag_M1S03_PickupLibraryReserveKey))
    {
        if (g_SavegamePtr->gameDifficulty_260 != GameDifficulty_Easy)
        {
            func_80088FF4(Chara_GreyChild, 12, 3);
        }
        if (g_SavegamePtr->gameDifficulty_260 == GameDifficulty_Hard)
        {
            func_80088FF4(Chara_GreyChild, 13, 3);
            func_80088FF4(Chara_GreyChild, 11, 7);
        }
        func_80088FF4(Chara_GreyChild, 14, 11);
        func_80088FF4(Chara_GreyChild, 15, 3);
    }

    playerHp = g_SysWork.player_4C.chara_0.health_B0;
    if (g_SavegamePtr->gameDifficulty_260 == GameDifficulty_Easy)
    {
        playerHp -= Q12(50.0f);
    }

    if (g_SavegamePtr->gameDifficulty_260 == GameDifficulty_Normal)
    {
        playerHp -= Q12(25.0f);
    }

    if (playerHp > Q12(20.0f))
    {
        func_80088FF4(Chara_Creaper, 0, 3);
    }
    else
    {
        func_80088FF4(Chara_Creaper, 0, 0);
    }

    if (playerHp > Q12(60.0f))
    {
        func_80088FF4(Chara_Creaper, 1, 3);
        func_80088FF4(Chara_Creaper, 2, 3);
    }
    else
    {
        func_80088FF4(Chara_Creaper, 1, 0);
        func_80088FF4(Chara_Creaper, 2, 0);
    }

    if (playerHp > Q12(80.0f))
    {
        func_80088FF4(Chara_Creaper, 3, 3);
        func_80088FF4(Chara_Creaper, 4, 3);
    }
    else
    {
        func_80088FF4(Chara_Creaper, 3, 0);
        func_80088FF4(Chara_Creaper, 4, 0);
    }
}

INCLUDE_RODATA("asm/maps/map1_s03/nonmatchings/map1_s03", D_800CBCAC);

void func_800DE828(void)
{
    s32 tmp0;
    s32 tmp1;
    const static VECTOR3 soundPos = VECTOR3(-58.81f, -1.4f, 18.02f);

    if (g_DeltaTime0 == 0)
    {
        if (Savegame_EventFlagGet(EventFlag_105))
        {
            g_WorldGfx_ObjectAdd(&g_WorldObject4.object_0, &g_WorldObject4.position_1C, &D_800CBC04);
        }
        if (Savegame_EventFlagGet(EventFlag_101) && Savegame_EventFlagGet(EventFlag_102))
        {
            g_WorldGfx_ObjectAdd(&g_WorldObject3.object_0, &g_WorldObject3.position_1C, &D_800CBC04);
        }
        g_WorldGfx_ObjectAdd(&g_WorldObject0.object_0, &g_WorldObject0.position_1C.position_0, &g_WorldObject0.position_1C.rotation_C);
        g_WorldGfx_ObjectAdd(&g_WorldObject1.object_0, &g_WorldObject1.position_1C.position_0, &g_WorldObject1.position_1C.rotation_C);
        g_WorldGfx_ObjectAdd(&g_WorldObject2.object_0, &g_WorldObject2.position_1C.position_0, &g_WorldObject2.position_1C.rotation_C);
    }
    else
    {
        if (Savegame_EventFlagGet(EventFlag_105) && !Savegame_EventFlagGet(EventFlag_106))
        {
            if (D_800E20EE == 6)
            {
                func_800892A4(18);
                func_8005DC1C(Sfx_Unk1460, &g_WorldObject2.position_1C.position_0, Q8_CLAMPED(1.0f), 2);
                D_800E20E8 = FP_ANGLE(-11.3f);
                D_800E20EE = 7;
                D_800E20EC = 0;
            }
            g_WorldObject2.position_1C.rotation_C.vy += D_800E20E8;
            if (D_800E20E8 == FP_ANGLE(-11.3f))
            {
                if (g_WorldObject2.position_1C.rotation_C.vy < FP_ANGLE(-168.8f))
                {
                    g_WorldObject2.position_1C.rotation_C.vy = FP_ANGLE(-168.8f);
                    D_800E20E8 = FP_ANGLE(2.9f);
                    func_8005DC1C(Sfx_Unk1434, &g_WorldObject2.position_1C.position_0, Q8_CLAMPED(1.0f), 2);
                }
            } 
            else if (((g_WorldObject2.position_1C.rotation_C.vy < FP_ANGLE(-168.8f)) && (D_800E20E8 < 0)) ||
                     ((g_WorldObject2.position_1C.rotation_C.vy >= FP_ANGLE(-157.45f)) && (D_800E20E8 > 0)))
            {

                tmp1 = -D_800E20E8 >> 1;
                D_800E20E8 = tmp1;
                if (ABS(tmp1) == 1)
                {
                    D_800E20E8 = 0;
                }
            }
            if (D_800E20E8 == 0)
            {
                Savegame_EventFlagSet(EventFlag_106);
            }
            g_WorldGfx_ObjectAdd(&g_WorldObject4.object_0, &g_WorldObject4.position_1C, &D_800CBC04);
        }
        else if (Savegame_EventFlagGet(EventFlag_106))
        {
            g_WorldObject2.position_1C.rotation_C.vy = FP_ANGLE(-157.4f);
            g_WorldGfx_ObjectAdd(&g_WorldObject4.object_0, &g_WorldObject4.position_1C, &D_800CBC04);
        }

        if (!Savegame_EventFlagGet(EventFlag_101) || !Savegame_EventFlagGet(EventFlag_102))
        {
            if (D_800E20E8 == 0)
            {
                if (!(Rng_Rand16() & 0x1F))
                {
                    D_800E20E8 = -((Rng_Rand16() & 7) + 2);
                }
            }
            if (D_800E20E8 != 0)
            {
                if (ABS(D_800E20E8) == 1)
                {
                    g_WorldObject1.position_1C.rotation_C.vy += D_800E20E8;
                }
                g_WorldObject1.position_1C.rotation_C.vy += D_800E20E8;

                if (D_800E20E8 > 0)
                {
                    if (g_WorldObject1.position_1C.rotation_C.vy > 0)
                    {
                        func_8005DC1C(Sfx_Unk1435, &soundPos, Q8_CLAMPED(0.5f), 0);
                        g_WorldObject1.position_1C.rotation_C.vy = 0;
    
                        if ((D_800E20E8 >= 8) && !(Rng_Rand16() & 3))
                        {
                            D_800E20E8 = 0;
                        }
                        else
                        {
                            D_800E20E8 = ((Rng_Rand16() & 3) - D_800E20E8) + 1;
                        }
                        D_800E20E8 = MIN(D_800E20E8, 0);
                    }
                }
                else if (g_WorldObject1.position_1C.rotation_C.vy < -FP_ANGLE(1.8f))
                {
                    func_8005DC1C(Sfx_Unk1435, &soundPos, Q8_CLAMPED(0.5f), 0);
    
                    D_800E20E8 = ~(Rng_Rand16() & 3) - D_800E20E8;
                    D_800E20E8 = MAX(D_800E20E8, 1);
                }
            }
        }
        else if (!Savegame_EventFlagGet(EventFlag_103) || D_800E20EE == 5)
        {
            switch (D_800E20EE)
            {
                case 0:
                    D_800E20E8 = FP_ANGLE(-1.45f);
                    D_800E20EC = 0;
                    D_800E20EE = 1;
                    /* fallthrough */
                case 1:
                    g_WorldObject1.position_1C.rotation_C.vy += D_800E20E8;
                    if (g_WorldObject1.position_1C.rotation_C.vy <  FP_ANGLE(-2.9f))
                    {
                        func_800892DC(18, 0x60);
                        func_8005DC1C(Sfx_Unk1434, &soundPos, Q8(0.7657f), 2);
                        g_WorldObject1.position_1C.rotation_C.vy = FP_ANGLE(-2.9f);
                        D_800E20E8 = FP_ANGLE(1.45f);
                        D_800E20EE = 2;
                    }
                    break;
                case 2:
                    D_800E20E8 -= 2;
                    g_WorldObject1.position_1C.rotation_C.vy += D_800E20E8;
                    if (g_WorldObject1.position_1C.rotation_C.vy > 0)
                    {
                        func_8005DC1C(Sfx_Unk1434, &soundPos, Q8(0.7657f), 2);
                        do { // @hack permuter find.
                            D_800E20E8 = Q12(-10.0f);
                            g_WorldObject1.position_1C.rotation_C.vy = 0;
                            D_800E20EE = 3;
                        } while (0);
                    }
                    break;
                case 3:
                    D_800E20EC += g_DeltaTime0;
                    if (D_800E20EC > Q12(3.0f))
                    {
                        D_800E20EE = 4;
                    }
                    break;
                case 4:
                case 5:
                    D_800E20E8 += FP_MULTIPLY_PRECISE(g_DeltaTime0, Q12(4.0f), Q12_SHIFT);
                    if (D_800E20E8 <= Q12(-2.0f))
                    {
                        tmp0 = D_800E20E8;
                    }
                    else
                    {
                        tmp0 = Q12(-2.0f);
                    }
                    D_800E20E8 = tmp0;
                    g_WorldObject1.position_1C.rotation_C.vy += FP_FROM(tmp0, Q12_SHIFT);
                    g_WorldGfx_ObjectAdd(&g_WorldObject3.object_0, &g_WorldObject3.position_1C, &D_800CBC04);
                    if (D_800E20EE == 4)
                    {
                        if (g_WorldObject1.position_1C.rotation_C.vy < FP_ANGLE(-5.7f))
                        {
                            func_8005DC1C(Sfx_Unk1436, &g_WorldObject1.position_1C.position_0, 0x80, 0);
                            D_800E20EE = 5;
                        }
                    }
                    if (g_WorldObject1.position_1C.rotation_C.vy < FP_ANGLE(-39.4f))
                    {
                        Savegame_EventFlagSet(EventFlag_103);
                    }
                    if (Savegame_EventFlagGet(EventFlag_104) || ScreenFade_IsFinished() || g_WorldObject1.position_1C.rotation_C.vy < -0x300)
                    {
                        g_WorldObject1.position_1C.rotation_C.vy = FP_ANGLE(-67.5f);
                        D_800E20EE = 6;
                    }
                    break;
                default:
                    break;
            }
        } 
        else
        {
            g_WorldObject1.position_1C.rotation_C.vy = FP_ANGLE(-157.5f);
            g_WorldGfx_ObjectAdd(&g_WorldObject3.object_0, &g_WorldObject3.position_1C, &D_800CBC04);
            if (!Savegame_EventFlagGet(EventFlag_105))
            {
                D_800E20EE = 6;
            }
        }
        g_WorldObject0.position_1C.rotation_C.vy = g_WorldObject1.position_1C.rotation_C.vy;
        g_WorldGfx_ObjectAdd(&g_WorldObject0.object_0, &g_WorldObject0.position_1C.position_0, &g_WorldObject0.position_1C.rotation_C);
        g_WorldGfx_ObjectAdd(&g_WorldObject1.object_0, &g_WorldObject1.position_1C.position_0, &g_WorldObject1.position_1C.rotation_C);
        g_WorldGfx_ObjectAdd(&g_WorldObject2.object_0, &g_WorldObject2.position_1C.position_0, &g_WorldObject2.position_1C.rotation_C);
    }
}
